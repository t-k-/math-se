L=\min_{K_{k+1}} trace(P_{k+1|k+1})
 P_{k+1|k+1} = \boldsymbol{ (I-K_{k+1} H_{k+1}) P_{k+1|k} (I-K_{k+1} H_{k+1})^{T} + K_{k+1}R_{k+1}K_{k+1}^T }
{\frac{\partial}{\partial \boldsymbol{A}}} (trace(\boldsymbol{ABA^T})) = 2\boldsymbol{AB}
{\frac{\partial L}{\partial \boldsymbol{ K_{k+1}}}} = -2(\boldsymbol{I-K_{k+1}H_{k+1})P_{k+1|k}H_{k+1}^T+2K_{k+1}R_{k+1} } = 0
H_{k+1}^T
\boldsymbol{A=I-K_{k+1} H_{k+1};   B=P_{k+1|k}}
{\frac{\partial}{\partial \boldsymbol{K_{k+1}}}} (trace(\boldsymbol{ABA^T})) = 2\boldsymbol{AB} * {\frac{\partial (trace (\boldsymbol{A}))}{\partial \boldsymbol{ K_{k+1}}}}
 {\frac{\partial trace(\boldsymbol{K_{k+1}H_{k+1}} )} {\boldsymbol{\partial K_{k+1}}}} =  \boldsymbol{H_{k+1}^T} 
 = -2(\boldsymbol{I-K_{k+1} H_{k+1}) * P_{k+1|k} * H_{k+1}^T}
\nabla_A(ABA^T)=A(B+B^T)=2AB
B
L=trace((I-KH)Q(I-KH)^T+KRK^T)
Q,R
DL_K:Z\rightarrow trace(-ZHQ(I-KH)^T+(I-KH)Q(-ZH)^T+ZRK^T+KRZ^T)=trace(-2ZHQ(I-KH)^T+2ZRK^T)=trace((-2HQ(I-KH)^T+2RK^T)Z)
(U,V)=trace(U^TV)
Z
(\nabla_K(L),Z)=DL_K(Z)
\nabla_K(L)=-2(I-KH)QH^T+2KR
DL_K
Z
f:K\rightarrow KAK
Df_K:Z\rightarrow ZAK+KAZ
(uv)'=u'v+uv'
f:K\rightarrow -KHQ
Df_K:Z\rightarrow -ZHQ
(ua)'=u'a
Df_X:(h,k,l)\rightarrow [3z,4y^3,3x][h,k,l]^T
(u,v)=trace(u^Tv)=u^Tv
\nabla_Xf=[3z,4y^3,3x]^T
f:K\in\mathcal{M}_n(\mathbb{R})\rightarrow KAK\in\mathcal{M}_n(\mathbb{R})
Df_K:Z\in\mathcal{M}_n(\mathbb{R})\rightarrow ZAK+KAZ\in\mathcal{M}_n(\mathbb{R})
g(K)=K^3
Dg_K(Z)=ZK^2+KZK+K^2Z
f:\mathbb{R^3}\rightarrow \mathbb{R}
X=[x,y,z]^T
Df_X
(h,k,l)\in\mathbb{R^3}\rightarrow \mathbb{R}
1\times 3
