\require{AMScd}
A
B
f: A \to B
\mathfrak{q}
B
\mathfrak{p} = f^{-1}(\mathfrak{q})
A_\mathfrak{p} \otimes_A B_\mathfrak{q} = B_\mathfrak{q}
\begin{align*} B_{\mathfrak{q}} &= [i_{\mathfrak{q}}^B(B\backslash\mathfrak{q})]^{-1}(B_{\mathfrak{p}})\\ &= [i_{\mathfrak{q}}^B(B\backslash\mathfrak{q})]^{-1}(B\otimes_A A_\mathfrak{p})\\ &= (A_\mathfrak{p}\otimes_A B) \otimes_\color{red}{B} B_{\mathfrak{q}}\\ &= A_\mathfrak{p}\otimes_A B_{\mathfrak{q}} \end{align*}
i_{\mathfrak{q}}^B : B \to B_{\mathfrak{q}}
\color{red}{B}
B
\mathfrak{p}
A_\mathfrak{p}-
B\otimes_A A_\mathfrak{p}
B-
A_\mathfrak{p}
B
B \otimes_A B_{\mathfrak{q}}
\color{blue}{\mathbf{(?)}}
A
S
A
A_S
M, N
A
A_S
M \otimes_{A} N  = M \otimes_{A_S} N
A_p, B_q
A_p
A
A_p \otimes_A B_q = A_p \otimes_{A_p} B_q=B_q
