n=1,2,3,7
(a,b)=d
\frac aA=\frac bB=d\implies (A,B)=1
 a^2+n\cdot b^2=d^2(A^2+n\cdot B^2)
n
(A^2,n)=(A,n)=D
\frac A{A_1}=\frac nN=D\implies (A_1,N)=1
A^2+n\cdot B^2
D^2\cdot A_1^2+N\cdot D\cdot B^2=D(D\cdot A^2_1+N\cdot B^2)
a^2+n\cdot b^2
D
N=1
a^2+n\cdot b^2,
(a,n\cdot b)=1
(1):
p^c
M=a^2+n\cdot b^2,
c\ge1
p
a^2\equiv-n\cdot b^2\pmod {p^c}\iff  (a\cdot b^{-1})^2\equiv-n\pmod {p^c}
\implies -n
p^c
p^c
a^2+n\cdot b^2
2^c
c\ge3,
M,n\equiv-1\pmod 8
x^2\equiv e\pmod {2^c}
4
\iff e\equiv1\pmod 8
2^x=a^2+n\cdot b^2
n
(a,b)=1, a\cdot b
x
y,
2^y=a_1^2+nb_1^2
x
x_\text{min},
2^{x_\text{min}}=a_2^2+n\cdot b_2^2
2^{x_\text{min}+y}=(a_1^2+n\cdot b_1^2)(a_2^2+n\cdot b_2^2)=(a_1a_2\pm n\cdot b_1b_2)^2+n(a_1b_2\mp a_2b_1)^2
a_1a_2\pm n\cdot b_1b_2,a_1b_2\mp a_2b_1
2
=2^k
2^{x_\text{min}+y-2k}=\left(\frac{a_1a_2\pm n\cdot b_1b_2}{2^k}\right)^2+n\left(\frac{a_1b_2\mp a_2b_1}{2^k}\right)^2
4^k,k\ge 2
a^2+15b^2
2^{3k+2},k\ge 1
a^2+31b^2
