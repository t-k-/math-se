N
\lfloor \frac xN \rfloor
x \in [-2^{31}, +2^{31})
\lfloor \frac x{100} \rfloor
\left\lfloor \frac {p \cdot \lfloor \frac x4 \rfloor + d}{q} \right\rfloor 
q= 2^{36}
p = \frac{q}{25} + 1
d = 2^{29}
x
p
q
d
N<2^{31}
N
2
m=\lfloor\log_2 N\rfloor
2^m < N < 2^{m+1}
\begin{eqnarray} a & = & \mathrm{round}\left(\frac{2^{32+m}}{N}\right) \hskip 1cm& (\Rightarrow 2^{31}<a<2^{32})\\ \Delta & = & aN - 2^{32+m} & (\Rightarrow 1\leq |\Delta|<\frac{N}{2})\\ B & = & \left\lfloor\frac{2^{31}}{N}\right\rfloor \\ d & = & B|\Delta| \end{eqnarray}
-2^{31}\leq x < 2^{31}
\left\lfloor \frac{x}{N}\right\rfloor = \left\lfloor \frac{ax+d}{2^{32+m}}\right\rfloor
x=uN+v
0\leq v\leq (N-1)
u
\frac{ax+d}{2^{32+m}} = \frac{aNu + av+d}{2^{32+m}} = u + \frac{u\Delta+B|\Delta| + av}{2^{32+m}}
x
-(B+1) \leq u \leq B
u=-(B+1)
\Delta > 0
\Delta \leq av
v\not =0
\Delta \leq N < 2^{31} \leq a\leq av
av
2^{32+m}
u\Delta + B|\Delta| + av = (u+1)\Delta + B|\Delta| + 2^{32+m} - a(N-v)
(u+1)\Delta + B|\Delta|<a(N-v)
u=B
v=(N-1)
x
BN+(N-1)=2^{31}-1
(B+1)N = 2^{31}
N
2
ax+d \geq a(-2^{31}) + d > 2^{32}(-2^{31}) = -2^{63}
ax+d\leq a(2^{31}-1)+d\leq 2^{32}(2^{31} - 1) + 2^{30} < 2^{63}
N=100
m=6
a=2748779069
\Delta=(-44)
B=21474836
d=944892784
>\!>
\left\lfloor \frac{x}{100}\right\rfloor=(2748779069x + 944892784) >\!> 38
