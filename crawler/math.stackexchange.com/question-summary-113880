 (a)^n  \bmod n^2 = (a \bmod n)^n  \bmod n^2
n=1
0
n\gt 1
a= r + kn + qn^2
0\leq r \lt n
0\leq k\lt n
a\bmod n = r
a\bmod n^2 = r+kn
a^n\equiv r^n\pmod{n^2}.
\begin{align*} a^n &\equiv (r+kn)^n \pmod{n^2}\\ &\equiv r^n + \binom{n}{1}r^{n-1}kn + \binom{n}{2}r^{n-2}(kn)^2 + \cdots + (kn)^n\pmod{n^2}\\ &\equiv r^n + r^{n-1}kn^2\pmod{n^2}\\ &\equiv r^n\pmod{n^2}, \end{align*}
k
(a + k n)^n = a^n + n a^{n-1} k n +  \dfrac{n(n-1)}{2} a^{n-2} k^2 n^2 + \cdots,
n^2
a^n
n^2
a
n
