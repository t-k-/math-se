x
p
f(x)=\sum_{i=0}^\infty \left(\left\lfloor\frac{i}{2^x}\right\rfloor+x+1\right)(1-p)^{i-1}p
\frac{p}{1-p} \left [ (1+x) \sum_{i=0}^{\lceil{2^x}\rceil} (1-p)^i + (2+x) \sum_{i=\lceil{2^x}\rceil + 1}^{2 \lceil{2^{x}}\rceil} (1-p)^i + (3+x) \sum_{i=2 \lceil{ 2^{x}}\rceil + 1}^{3 \lceil{2^{x}}\rceil} (1-p)^i + \ldots \right ]
 =\frac{p}{1-p} \sum_{k=1}^{\infty} (k+x) \sum_{i=(k-1)\lceil{2^x}\rceil + 1}^{k \lceil{2^x}\rceil} (1-p)^i   
 = \frac{p}{1-p} \sum_{k=1}^{\infty} (k+x) \left [ (1-p)^{(k-1)\lceil{2^x}\rceil} - (1-p)^{k\lceil{2^x}\rceil} \right ] 
 = \frac{p^2}{1-p} \sum_{k=1}^{\infty} (k+x)\left[(1-p)^{\lceil{2^x}\rceil} \right ]^{k-1} 
\sum_{k=1}^{\infty} k q^{k-1}
 = \frac{p^2}{1-p} \left [\frac{(1-p)^{\lceil{2^x}\rceil}}{1- (1-p)^{\lceil{2^x}\rceil}} + \frac{x}{\left [1- (1-p)^{\lceil{2^x}\rceil}\right ]^2} \right ] 
x
